{{!div class="modal-body"}}
{{#instance}}
<form action="javascript://">
  <div class="row-fluid">
    <div class="span5">
      <label>
        Response
        <span class="required">*</span>
      </label>
      <div class="wysiwyg-area">
          <textarea id="response_description" tabindex="1" class="input-block-level double wysihtml5" placeholder="Response Title" name="description" autofocus>{{{description}}}</textarea>
      </div>
    </div>
    
    {{#using contact=instance.contact}}
    {{#with_current_user_as 'current_user'}}
    <div class="span5">
      <label>
        Assignee
        <span class="required">*</span>
      </label>
      <i class="grcicon-person-green pull-left icon-field"></i>
      <div class="objective-selector">
        {{#if new_object_form}}
          {{#using request=instance.request}}
          {{#using request_assignee=request.assignee}}
            <input tabindex="3" type="text" name="contact.email" class="span11 search-icon" placeholder="Enter text to search for Assignee" data-lookup="Person" value="{{firstnonempty contact.email request_assignee.email ''}}">
            <input type="hidden" name="contact.id" value="{{firstnonempty contact.id request_assignee.id ''}}">
          {{/using}}
          {{/using}}
        {{else}}
          <input tabindex="3" type="text" name="contact.email" class="span11" data-lookup="Person" value="{{firstnonempty contact.email parent_instance.assignee.reify.email ''}}">
          <input type="hidden" name="contact.id" value="{{firstnonempty contact.id ''}}">
        {{/if}}
      </div>
    </div>
    {{/with_current_user_as}}
    {{/using}}
    
    <div class="span2">
      <label>
        Status
      </label>
      <select class="input-block-level" name="status" {{#new_object_form}}disabled="true"{{/new_object_form}} tabindex="2">
        {{#iterate 'Assigned' 'Submitted' 'Accepted' 'Rejected'}}
        <option {{#if_equals iterator instance.status}}selected="true"{{/if_equals}}>{{iterator}}</option>
        {{/iterate}}
      </select>
    </div>
  </div>
  
  <div class="row-fluid">
    {{#if_instance_of instance "DocumentationResponse"}}
    <div class="span6">
      <ggrc-modal-connector
        instance="instance"
        source_mapping="documents"
        mapping="documents"
        deferred="true"
        >
        <label>
          Evidence
          <i class="grcicon-document pull-left icon-field"></i>
          <a href="javascript://" class="field-hide">hide</a>
        </label>
        {{#each list}}
        <div class="row-fluid">
          <div class="span11 oneline">
            <a class="url" data-popover-trigger="sticky-hover" data-sticky-popover="true" data-content="{{render '/static/mustache/pbc/iframe_tooltip.mustache' url=link}}" href="{{schemed_url link}}" target="_blank">
              {{firstnonempty title link}}
            </a>
          </div>
          <div class="span1">
            <a href="javascript://" class="unmap" data-toggle="unmap">
              <span class="result" {{data 'result'}}></span>
              <i class="grcicon-deleted"></i>
            </a>
          </div>
        </div>
        {{/each}}
        {{^list.length}}
          <div class="span12">
            <em>No meetings</em>
          </div>
        {{/list.length}}
        {{^if_hooks 'DocumentationResponse.modal_connector'}}
        {{#prune_context}}
          <br>
          <div class="span12 objective-selector">
            <div style="float:left">
              <label for="link" style="line-height:29px">Add Evidence URL: &nbsp;</label>
            </div>
            <div style="float:left"><input tabindex="3" type="text" name="link" placeholder="Enter Evidence URL here" value="{{attributes.link}}"></div>
            <input type="hidden" name="context" model="Context" value="{{instance.context.id}}">
            <div style="clear:both; height:1px">&nbsp;</div>
            <div style="float:left">
              <label for="title" style="line-height:29px">Evidence title (optional): &nbsp;</label>
            </div>
            <div style="float:left"><input tabindex="3" type="text" name="title" placeholder="Enter title here" value="{{attributes.title}}"></div>            
            <div style="clear:both">
              <a href="javascript://" class="btn btn-success {{^attributes.title}}disabled{{/attributes.title}} no-float" data-toggle="submit">Add</a>
            </div>
          </div>
        {{/prune_context}}
        {{/if_hooks}}
        {{{render_hooks 'DocumentationResponse.modal_connector'}}}
      </ggrc-modal-connector>
    </div>
    {{/if_instance_of}}

    {{#if_instance_of instance "InterviewResponse"}}
    <div class="span6">
      <ggrc-modal-connector
        instance="instance"
        source_mapping="meetings"
        mapping="meetings"
        deferred="true"
        >
        <label>
          Meetings
          <i class="grcicon-calendar pull-left icon-field"></i>
          <a href="javascript://" class="field-hide">hide</a>
        </label>
        {{#each list}}
        <div class="span12">
          <a class="url" data-popover-trigger="sticky-hover" data-sticky-popover="true" data-content="{{render '/static/mustache/pbc/iframe_tooltip.mustache' url=title}}" href="{{schemed_url title}}" target="_blank">
            {{title}}
          </a>
          <a href="javascript://" class="unmap" data-toggle="unmap">
            <span class="result" {{data 'result'}}></span>
            <i class="grcicon-deleted"></i>
          </a>
        </div>
        {{/each}}
        {{^list.length}}
          <div class="span12">
            <em>No meetings</em>
          </div>
        {{/list.length}}
        {{#prune_context}}
          <br>
          <div class="span12 objective-selector">
            <div style="float:left">
              <label for="title" style="line-height:29px">Add Meeting URL: &nbsp;</label>
            </div>
            <div style="float:left"><input tabindex="3" type="text" name="title" placeholder="Enter Meeting URL here" value="{{attributes.title}}"></div>
            <input type="hidden" name="context" model="Context" value="{{instance.context.id}}">
            <input type="hidden" name="start_at" value="{{localize_datetime}}">
            <input type="hidden" name="end_at" value="{{localize_datetime}}">
            <a href="javascript://" class="btn btn-success {{^attributes.title}}disabled{{/attributes.title}} no-float" data-toggle="submit">Add</a>
          </div>
        {{/prune_context}}
      </ggrc-modal-connector>
    </div>
    {{/if_instance_of}}

    <div class="span6">
      <ggrc-modal-connector
        instance="instance"
        source_mapping="business_objects"
        deferred="true"
        >
        <label>
          Mapped Objects
          <a href="javascript://" class="field-hide">hide</a>
        </label>
        {{#each list}}
        <div class="row-fluid">
          <div class="span11 oneline">
            <a class="url" data-popover-trigger="sticky-hover" data-sticky-popover="true" data-content="{{render '/static/mustache/pbc/iframe_tooltip.mustache' url=link}}" href="{{schemed_url link}}" target="_blank">
              {{title}}
            </a>
          </div>
          <div class="span1">
            <a href="javascript://" class="unmap" data-toggle="unmap">
              <span class="result" {{data 'result'}}></span>
              <i class="grcicon-deleted"></i>
            </a>
          </div>
        </div>
        {{/each}}
        {{^list.length}}
          <div class="span12">
            <em>No mapped</em>
          </div>
        {{/list.length}}
        {{#prune_context}}
          <br>
          <div class="span12 objective-selector">         
            <div style="clear:both">
               <a class="section-add section-sticky"
                 href="javascript://" rel="tooltip"
                 {{#instance}}{{data 'join-object'}}{{/instance}}
                 data-placement="left"
                 data-toggle="multitype-object-modal-selector"
                 data-deferred="true"
                 data-object-source="true"
                 data-join-mapping="business_objects"
                 data-join-object-id="{{instance.id}}"
                 data-join-object-type="{{instance.class.model_singular}}"
                 {{#if_instance_of instance 'DocumentationResponse'}}data-exclude-option-types="Document"{{/if_instance_of}}
                 data-original-title="Map Object to this {{instance.class.title_singular}}">
                Map Object
              </a>
            </div>
          </div>
        {{/prune_context}}
      </ggrc-modal-connector>

    </div>
  </div>

  {{#new_object_form}}
  {{#using request=instance.request}}
  <input type="hidden" name="request.id" value="{{request.id}}">
  <input type="hidden" name="response_type" value="{{request.request_type}}">
  {{/using}}
  {{/new_object_form}}
</form>
{{/instance}}
{{!/div}}
