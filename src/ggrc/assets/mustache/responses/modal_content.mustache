{{!div class="modal-body"}}
{{#instance}}
<form action="javascript://">
  <div class="row-fluid">
    <div class="span5">
      <label>
        Response
        <span class="required">*</span>
      </label>
      <div class="wysiwyg-area">
          <textarea id="response_description" tabindex="1" class="input-block-level double wysihtml5" placeholder="Response Title" name="description" autofocus>{{{description}}}</textarea>
      </div>
    </div>
    
    {{#using contact=instance.contact}}
    {{#with_current_user_as 'current_user'}}
    <div class="span5">
      <label>
        Assignee
        <span class="required">*</span>
      </label>
      <i class="grcicon-person-green pull-left icon-field"></i>
      <div class="objective-selector">
        {{#if new_object_form}}
          {{#using request=instance.request}}
          {{#using request_assignee=request.assignee}}
            <input tabindex="3" type="text" name="contact.email" class="span11 search-icon" placeholder="Enter text to search for Assignee" data-lookup="Person" value="{{firstnonempty contact.email request_assignee.email ''}}">
            <input type="hidden" name="contact.id" value="{{firstnonempty contact.id request_assignee.id ''}}">
          {{/using}}
          {{/using}}
        {{else}}
          <input tabindex="3" type="text" name="contact.email" class="span11" data-lookup="Person" value="{{firstnonempty contact.email parent_instance.assignee.reify.email ''}}">
          <input type="hidden" name="contact.id" value="{{firstnonempty contact.id ''}}">
        {{/if}}
      </div>
    </div>
    {{/with_current_user_as}}
    {{/using}}
    
    <div class="span2">
      <label>
        Status
      </label>
      <select class="input-block-level" name="status" {{#new_object_form}}disabled="true"{{/new_object_form}} tabindex="2">
        {{#iterate 'Assigned' 'Submitted' 'Accepted' 'Rejected'}}
        <option {{#if_equals iterator instance.status}}selected="true"{{/if_equals}}>{{iterator}}</option>
        {{/iterate}}
      </select>
    </div>
  </div>
  
  <div class="row-fluid">
    {{#if_instance_of instance "InterviewResponse"}}
    <div class="span6">
      <ggrc-modal-connector
        instance="instance"
        source_mapping="meetings"
        mapping="meetings"
        deferred="true"
        >
        <label>
          Meetings
          <i class="grcicon-calendar pull-left icon-field"></i>
          <a href="javascript://" class="field-hide">hide</a>
        </label>
        {{#each list}}
        <div class="span12">
          <a class="url" data-popover-trigger="sticky-hover" data-sticky-popover="true" data-content="{{render '/static/mustache/pbc/iframe_tooltip.mustache' url=url}}" href="{{schemed_url url}}" target="_blank">
            {{url}}
          </a>
          <a href="javascript://" class="unmap" data-toggle="unmap">
            <span class="result" {{data 'result'}}></span>
            <i class="grcicon-deleted"></i>
          </a>
        </div>
        {{/each}}
        {{^list.length}}
          <div class="span12">
            <em>No meetings</em>
          </div>
        {{/list.length}}
        {{#prune_context}}
          <br>
          <div class="span12 objective-selector">
            <div style="float:left">
              <label for="url" style="line-height:29px">Add Meeting URL: &nbsp;</label>
            </div>
            <div style="float:left"><input tabindex="3" type="text" name="url" placeholder="Enter Meeting URL here" value="{{attributes.url}}"></div>
            <input type="hidden" name="context" model="Context" value="{{instance.context.id}}">
            <input type="hidden" name="start_at" value="{{localize_datetime}}">
            <input type="hidden" name="end_at" value="{{localize_datetime}}">
            <input type="hidden" name="title" value="Meeting">
            <a href="javascript://" class="btn btn-success {{^attributes.url}}disabled{{/attributes.url}} no-float" data-toggle="submit">Add</a>
          </div>
        {{/prune_context}}
      </ggrc-modal-connector>
    </div>
    {{/if_instance_of}}
  </div>

  {{#new_object_form}}
  {{#using request=instance.request}}
  <input type="hidden" name="request.id" value="{{request.id}}">
  <input type="hidden" name="response_type" value="{{request.request_type}}">
  {{/using}}
  {{/new_object_form}}
</form>
{{/instance}}
{{!/div}}
