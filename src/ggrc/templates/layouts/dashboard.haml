-#
-# Copyright (C) 2013 Google Inc., authors, and contributors <see AUTHORS file>
-# Licensed under http://www.apache.org/licenses/LICENSE-2.0 <see LICENSE file>
-# Created By:
-# Maintained By:
-#
-extends 'layouts/base.haml'

-macro dropup_create_new(type, type_plural, type_model=None)
  -set type_model = type_model or type|nospace
  %li
    %a{ 'href': "javascript://", 'data-toggle': 'modal-ajax-form', 'data-modal-reset': 'reset', 'data-form-target': 'redirect', 'data-modal-class': 'modal-wide', 'data-object-singular' : '={type_model}', 'data-object-plural' : '={type_plural}' }
      {{ type }}
-endmacro

-block page_help scoped

-block body
  -# FIXME: Fix page_type_attributes, etc
  -#{ page_type_attributes, :class => "#{has_feature?(:BETA) ? 'BETA' : ''}" }
  %body{ 'data-target': '.bs-docs-sidebar', 'data-spy': 'scroll' }

    %header.header.main
      .header-bar
        .container-fluid
          .row-fluid
            .span12
              .logo.pull-left
                %a{ 'href': "/dashboard" }
                  -#FIXME: Company logo/name
                  -set logo_url = config.get("COMPANY_LOGO")
                  -set logo_text = config.get("COMPANY_LOGO_TEXT")
                  -if logo_url
                    %img{ "src" : "#{logo_url}", 'alt' : 'GRC', 'title' : 'GRC'}
                  -elif logo_text != None
                    =logo_text
                  -else
                    Google GRC
              %ul.menu
                %li.quick-search
                  .quick-search-holder
                    %button{'type':'submit'}
                      %i.grcicon-search-white
                    %input.ui-corner-all.widgetsearch.clear-value{ 'type':'text', 'placeholder':'Type to Search / Create' }
                  .quick-search-results
                    %a.remove{ 'href': "#", 'class': "btn btn-mini pull-right", 'rel': "tooltip", 'title': "Hide", 'data-placement': "left"}
                      %i.grcicon-x-grey
                    %p.title
                      Search Results
                      -with quick_result = True
                        -include 'shared/_quick_find.haml'

                    .quick-find-add
                      Didn't find it in results?
                      .btn-group.pull-right.dropup
                        %a.btn.btn-mini.dropdown-toggle{ 'href': '#', 'data-toggle': 'dropdown'}
                          %i.grcicon-add-black
                          Object
                          %i.grcicon-carot
                        %ul.dropdown-menu
                          %li.divider
                          %li.title Create New ...
                          =dropup_create_new("Program", "programs")
                          =dropup_create_new("Regulation", "regulations")
                          =dropup_create_new("Contract", "contracts")
                          =dropup_create_new("Policy", "policies")
                          -# FIXME: Limit view to risk managers
                          -#if current_user.can_manage_risk
                          =dropup_create_new("Risky Attribute", "risky_attributes")
                          =dropup_create_new("Risk", "risks")
                          =dropup_create_new("Control", "controls")
                          %li.divider
                          =dropup_create_new("Process", 'processes')
                          =dropup_create_new("System", 'systems', "StrictSystem")
                          %li.divider
                          =dropup_create_new("Org Group", 'org_groups')
                          =dropup_create_new("Product", 'products')
                          =dropup_create_new("Project", 'projects')
                          =dropup_create_new("Facility", 'facilities')
                          =dropup_create_new("Market", 'markets')
                          =dropup_create_new("Data Asset", 'data_assets')
                %li.black-link
                  %a{ 'href': "javascript://", 'data-toggle': 'modal-ajax', 'data-modal-type': 'helpform', 'data-help-slug' : '{{ self.page_help()|trim }}'}
                    %i.grcicon-help
                    %span
                      Help
                %li.user.dropdown.dropdown-black.black-link
                  %a.dropdown-toggle{ 'href': "#", 'data-toggle': "dropdown", 'role': "button" }
                    %i.grcicon-user
                    %span
                      -# FIXME: Use actual account information
                      %strong
                        =current_user.email
                    %i.grcicon-carot-white
                  %ul.dropdown-menu{'aria-labelledby': 'drop1', 'role': "menu"}
                    -# FIXME: Restrict view to administrators
                    -#if current_user.can_admin?
                    -# FIXME: Fix link
                    %li
                      %a{'href': "admin_dash_path"}
                        %i.grcicon-admin
                        Admin Area
                    %li
                      %a.clear-display-settings{'href': "javascript://", 'tabindex': "-1"}
                        %i.grcicon-desktop
                        Reset Layout to Default
                    %li
                      %a.set-display-settings-default{'href': "javascript://", 'tabindex': "-1"}
                        %i.grcicon-desktop
                        Set Layout as Default
                    %li
                      -# FIXME: Fix link
                      %a{'href': '={ url_for("logout") }', 'tabindex': "-1"}
                        %i.grcicon-logout
                        Logout
                %li.screen.dropdown.dropdown-black.black-link
                  %a{'href': "#", 'class': "dropdown-toggle screen-size", 'data-toggle': "dropdown", 'role': "button"}
                    %i.grcicon-desktop
                    %span
                      100%
                    %i.grcicon-carot-white
                  %ul.dropdown-menu{ 'aria-labelledby': 'drop2', 'role': "menu" }
                    %li.full-view
                      %a{'href': '#', 'tabindex': "-1"}
                        %i.grcicon-wide
                        100%
                    %li.wide-view
                      %a{'href': '#', 'tabindex': "-1"}
                        %i.grcicon-wide
                        Wide
                    %li.narrow-view
                      %a{'href': '#', 'tabindex': "-1"}
                        %i.grcicon-normal
                        Narrow
    -block subheader_plus

    .clearfix
      .lhs
        -#NEW LHS
        .lhs-search
          %input{ 'type': 'text', 'class': 'input-block-level', 'placeholder': 'Search...' }
        .lhs-nav.emphesized
          %ul.top-level
            %li.programs
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-program-color' }
                Programs
                %small
                  (5)
        .lhs-nav
          %h2.governance Governance
          %ul.top-level
            %li.governance
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-control-color' }
                Controls
                %small
                  (142)
            %li.governance
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-contract-color' }
                Contracts
                %small
                  (12)
            %li.governance
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-policy-color' }
                Policies
                %small
                  (2)
            %li.governance
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-regulation-color' }
                Regulations
                %small
                  (7)
          %h2.business Assets/Business
          %ul.top-level
            %li.business
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-process-color' }
                Processes
                %small
                  (142)
            %li.business
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-system-color' }
                Systems
                %small
                  (12)
            %li.business
              %a{ 'href': '#', 'class': 'active' }
                %i{ 'class': 'grcicon-orggroup-color' }
                Org Groups
                %small
                  (10)
              .extended
                .row-fluid
                  .span12
                    %a.business.oneline{ 'href': '#' }
                      West Virginia IT Disciples Pack of Hard Core Crew
                      %i.grcicon-goto
                .row-fluid
                  .span12
                    .rtf
                      %p
                        Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.
                    %a.url.oneline{ 'href': '#' }
                      http://gdrive.google.com/googleplex/4839009/westvirginia/process/7894324974328974
                .row-fluid
                  .span6
                    .info
                      %strong Owner:
                      %span.error
                        Not Assigned
                  .span6
                    .info
                      %i.grcicon-control-color
                      6
                      &nbsp;&nbsp;
                      %i.grcicon-process-color
                      9
                      &nbsp;&nbsp;
                      %i.grcicon-system-color
                      1
                .links
                  .row-fluid
                    .span6
                      %a.secondary{ 'href': '#' }
                        View Process
                    .span6
                      %a.primary{ 'href': '#' }
                        Map to this program
                        %i.grcicon-reg-map
              %ul.sub-level
                %li.business
                  %a{ 'href': '#' }
                    .row-fluid
                      .span9
                        %span.lhs-item
                          Google IT
                      .span1
                        &nbsp;
                      .span1
                %li.business
                  %a{ 'href': '#', 'class': 'active' }
                    .row-fluid
                      .span9
                        %span.lhs-item
                          West Virginia IT Disciples Pack of Hard Core Crew
                      .span1
                        &nbsp;
                      .span1
                        %i.grcicon-people-warning
                %li.business
                  %a{ 'href': '#' }
                    .row-fluid
                      .span9
                        %span.lhs-item
                          Abroad
                      .span1
                        &nbsp;
                      .span1
                %li.business
                  %a{ 'href': '#' }
                    .row-fluid
                      .span9
                        %span.lhs-item
                          Google MTV
                      .span1
                        &nbsp;
                      .span1
                %li.business
                  %a{ 'href': '#' }
                    .row-fluid
                      .span9
                        %span.lhs-item
                          Google SFO
                      .span1
                        &nbsp;
                      .span1
                %li.business
                  %a{ 'href': '#' }
                    .row-fluid
                      .span9
                        %span.lhs-item
                          Misc
                      .span1
                        &nbsp;
                      .span1

                %li.view-more
                  %a{ 'href': '#' }
                    view more
                    %i.grcicon-down
                %li.add-new
                  %a{ 'href': '#' }
                    + add new


            %li.business
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-project-color' }
                Projects
                %small
                  (7)
            %li.business
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-facility-color' }
                Facilities
                %small
                  (2)
            %li.business
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-product-color' }
                Products
                %small
                  (0)
            %li.business
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-dataasset-color' }
                Data Assets
                %small
                  (13)
            %li.business
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-market-color' }
                Markets
                %small
                  (11)
          %h2.risk Risk Management
          %ul.top-level
            %li.risk
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-risk-color' }
                Risks
                %small
                  (12)
            %li.risk
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-riskyattribute-color' }
                Attributes
                %small
                  (9)
        .bar-h
        -#.lhs-nav
          -#%h2 My Work
        -#.bar-h
        .lhs-nav
          %h2 Recently Viewed
          %ul.top-level
            %li.risk
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-policy-color' }
                User Agreement
            %li.programs
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-program-color' }
                PCI Compliance
            %li.business
              %a{ 'href': '#'}
                %i{ 'class': 'grcicon-market-color' }
                Southern China

        .bar-h
      .bar-v
      .area
        .header-content{ 'data-spy': 'affix', 'data-offset-top': '25' }
          .row-fluid
            .span5
              -block header
            .span7
              -block subheader_extras
        %section.content{ 'data-spy': 'affix', 'data-offset-top': '25' }
          .flash
            -#FIXME: Flash messages
            -#flash.each do |type, value|
              -value = [value] unless value.is_a?(Array)
              -value = value.map(:presence).compact
              -if value.size > 0
                %div{ 'class': type }
                  %a.close{'href': "#{}", :'data-dismiss': "alert"}
                    &times;
                  -value.each do |message|
                    %p=message
          -block main
    %section.footer
      .container-fluid
        .row-fluid
          .span12
            %ul.bottom-nav.pull-left
              -#FIXME: demo mode?
              -#%li
                -if controller_name == 'design'
                  -path = dashboard_path
                -else
                  -path = request.fullpath
                -path = path.gsub(/BETA=[^&]*&?/, '').sub(/[?&]$/, '')
                -path += path.include?('?') ? '&' : '?'
                -if has_feature? 'BETA'
                  %a.demo-hide{ 'href': "#{path}BETA=0" }
                    Hide Demo
                -else
                  %a.demo-show{ 'href': "#{path}BETA=1" }
                    Show Demo
            %p
              -#FIXME: Copyright footer
              -#=CMS_CONFIG['COMPANY']
              Confidential.
              Copyright &copy;
              -#=Time.now.year
              =config.get('COMPANY')
              Version
              =config.get('VERSION')
