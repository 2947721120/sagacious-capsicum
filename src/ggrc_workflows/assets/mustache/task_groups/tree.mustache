{{!
    Copyright (C) 2013 Google Inc., authors, and contributors <see AUTHORS file>
    Licensed under http://www.apache.org/licenses/LICENSE-2.0 <see LICENSE file>
    Created By: laran@reciprocitylabs.com
    Maintained By: laran@reciprocitylabs.com
}}
  <li class="tree-item program task-group-index" data-object-id="{{instance.id}}" data-object-type="{{instance.class.table_singular}}">
    <div class="item-main" {{#instance}}{{data 'model'}}{{/instance}} data-model="true">
      <div class="openclose">
        <div class="row-fluid">
          <div class="span12">
            <div class="item-data">
              <div class="span3">
                {{instance.title}}
              </div>
              <div class="span3" {{ (el) -> el.ggrc_controllers_quick_form({ instance : el.closest('[data-model]').data('model')}); }}>
                <i class="grcicon-person-green pull-left"></i>
                {{#using assignee=instance.contact}}
                {{#if true}}
                    <div class="objective-selector">
                      <input type="text" name="contact.name" data-lookup="Person" class="span8 short-field search-icon" placeholder="Enter text to search for Assignee" value="{{firstnonempty assignee.name assignee.email ''}}">
                    </div>
                {{else}}
                  <div class="item-data">
                    <span class="tree-title-area read-only oneline">
                      {{{renderLive '/static/mustache/people/popover.mustache' person=assignee}}}
                    </span>
                  </div>
                {{/if}}
                {{/using}}
              </div>
              <div class="span3">
                &nbsp;
              </div>
              <div class="span1">
                {{#with_mapping 'objects' instance}}
                <span class="counter" rel="tooltip" data-placement="left" data-original-title="# of mapped objects">
                  <i class="grcicon-object-black"></i>
                  <strong class="error">{{objects.length}}</strong>
                </span>
                {{/with_mapping}}
              </div>
              <div class="span1">
                {{#with_mapping 'tasks' instance}}
                <span class="counter" rel="tooltip" data-placement="left" data-original-title="# of mapped tasks">
                  <i class="grcicon-task-black"></i>
                  <strong class="error">{{tasks.length}}</strong>
                </span>
                {{/with_mapping}}
              </div>
              <div class="span1">
                {{#is_allowed 'delete' instance context='for'}}
                <span class="counter removeTaskGroup">
                  <a href="javascript://"
                    class="info-action delete"
                    data-toggle="modal-ajax-deleteform"
                    data-object-plural="{{model.table_plural}}"
                    data-object-singular="{{model.model_singular}}"
                    data-modal-reset="reset"
                    data-modal-class="modal"
                    data-refresh="true"
                    data-object-id="{{instance.id}}">
                    <i class="grcicon-deleted"></i>
                  </a>
                </span>
                {{/is_allowed}}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="tier-2-info item-content" style="display: none;">
      <div class="tier-2-info-content">
        <div class="show-description">
          {{> /static/mustache/task_groups/tier2_content.mustache}}

      {{#if draw_children}}
        {{#prune_context}} {{! this line is just chopping the context stack down to one element}}

          <div class="row-fluid">
            {{#child_options.0}}
            <div class="span6">
              <strong>Objects (<span>{{list.length}}{{#if_null list}}...{{/if_null}}</span>)</strong><br>
              <ul class="items-list tree-structure new-tree" {{data 'options'}} {{ (el) -> el.cms_controllers_tree_view(el.data("options")) }}></ul>
              </ul>
            </div>
            {{/child_options.0}}


            {{#child_options.1}}
            <div class="span6 task-list">
              {{#if list.length}}
              {{^if_equals list.length 1}}
              <span class="pull-right lock-wrap" {{#instance}}{{data 'instance'}}{{/instance}} {{ (el) -> $(el).ggrc_controllers_quick_form({ instance: $(el).data("instance") }); }}>
                <label>
                  <input type="checkbox" name="lock_task_order" {{#instance.lock_task_order}}checked="checked"{{/instance.lock_task_order}}>
                  Lock Task Order
                </label>
              </span>
              {{/if_equals}}
              {{/if}}
              <strong>Tasks (<span>{{list.length}}{{#if_null list}}...{{/if_null}}</span>)</strong><br>
              <ul class="tree-structure new-tree" {{data 'options'}}
                {{ (el) -> el.cms_controllers_tree_view(el.data("options")) }}
                {{sortable_if instance.lock_task_order '{ "items": "li:not(.tree-footer)", "handle": ".drag" }' inverse=true}}></ul>

            </div>
            {{/child_options.1}}
          </div>
        {{/prune_context}}
      {{/if}}

        </div>
      </div>
    </div>
  </li>
