{{!
    Copyright (C) 2013 Google Inc., authors, and contributors <see AUTHORS file>
    Licensed under http://www.apache.org/licenses/LICENSE-2.0 <see LICENSE file>
    Created By: laran@reciprocitylabs.com
    Maintained By: laran@reciprocitylabs.com
}}
  <li class="tree-item task-group-index" data-object-id="{{instance.id}}" data-object-type="{{instance.class.table_singular}}">
    <div class="item-main" {{#instance}}{{data 'model'}}{{/instance}} data-model="true">
      <div class="item-wrap">
        <div class="openclose">
          <span class="status-label status-{{to_class parent_instance.status '_'}}"></span>
          <i class="grcicon-arrow-right"></i>
        </div>
        <div class="select {{^if_equals parent_instance.task_groups.length 1}}ordered-item-data{{/if}}">
          <div class="item-data">
            <div class="row-fluid">
              <div class="span6">
                <div class="title tree-title-area">
                  <!-- This drag icon is just temporary here until we move 2nd tier info to bottom info pin -->
                  {{^if_equals parent_instance.task_groups.length 1}}
                    <span class="drag"><i class="grcicon-drag"></i></span>
                  {{/if}}
                  {{instance.title}}
                </div>
              </div>
              <div class="span2" {{ (el) -> el.ggrc_controllers_quick_form({ instance : el.closest('[data-model]').data('model')}); }}>
                <div class="owner tree-title-area">
                  {{#using assignee=instance.contact}}
                    {{#using workflow=instance.workflow}}
                      {{{renderLive '/static/mustache/people/popover.mustache' person=assignee}}}
                    {{/using}}
                  {{/using}}
                </div>
              </div>
              <div class="span4">
                <ul class="tree-action-list">
                  <li>
                    {{#with_mapping 'objects' instance}}
                    <span class="counter" rel="tooltip" data-placement="left" data-original-title="# of mapped objects">
                      <i class="grcicon-object-black"></i>
                      <strong class="error">{{objects.length}}</strong>
                    </span>
                    {{/with_mapping}}
                  </li>
                  <li>
                    {{#with_mapping 'task_group_tasks' instance}}
                    <span class="counter" rel="tooltip" data-placement="left" data-original-title="# of mapped tasks">
                      <i class="grcicon-task-black"></i>
                      <strong class="error">{{task_group_tasks.length}}</strong>
                    </span>
                    {{/with_mapping}}
                  </li>
                </ul>
              </div>
            </div>
          </div><!-- item-data end -->
        </div><!-- select end -->
      </div><!-- item-wrap end -->
    </div><!-- item-main end -->

    <div class="tier-2-info item-content" style="display: none;">
      <div class="tier-2-info-content">

          {{> /static/mustache/task_groups/tier2_content.mustache}}

          {{#if draw_children}}
            {{#prune_context}} {{! this line is just chopping the context stack down to one element}}
            <div class="template-setup">
              <div class="row-fluid wrap-row">
                <div class="span8 task-list">
                  {{#child_options.1}}
                    <h3>Tasks (<span>{{list.length}}{{#if_null list}}...{{/if_null}}</span>)</h3>
                    <h4 class="inline-explanation">Define and reorder tasks</h4>
                    <ul class="tree-structure new-tree" {{data 'options'}}
                      {{ (el) -> el.cms_controllers_tree_view(el.data("options")) }}
                      {{sortable_if instance.lock_task_order '{ "items": "li:not(.tree-footer)", "handle": ".drag" }' inverse=true}}>
                    </ul>
                  {{/child_options.1}}
                </div>

                <div class="span4">
                  {{#child_options.0}}
                    <h3>Objects (<span>{{list.length}}{{#if_null list}}...{{/if_null}}</span>)</h3>
                    <h4 class="inline-explanation">Choose objects that tasks will apply to</h4>

                    <ul class="tree-structure new-tree" {{data 'options'}}
                      {{ (el) -> el.cms_controllers_tree_view(el.data("options")) }}>
                    </ul>
                  {{/child_options.0}}
                </div>
              </div>
            </div>
            {{/prune_context}}
          {{/if}}
        </div>
      </div>
    </div>
  </li>
