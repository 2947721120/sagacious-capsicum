<div class="row-fluid">
  <div class="span12">

    <h6>gDrive Evidence Folder</h6>

      <p class="oneline">
        {{#with_mapping 'folders' instance}}
          {{#if folders.length}}
            <a href="{{folders.0.instance.alternateLink}}" target="_blank">
              {{folders.0.instance.title}}
            </a>
          {{else}}
            <span class="error">
              No folder for this {{instance.class.title_singular}}.
            </span>
            {{#with_current_user_as 'current_user'}}
            {{#using contact=instance.contact}}
            {{#if_helpers '\
              #is_allowed' '__GGRC_ADMIN__' '\
              or #if_equals' contact current_user}}
            <a href="javascript://" class="entry-attachment tree-item-add" data-toggle="gdrive-picker"
              data-model="{{instance.type}}" data-type="folders" data-id="{{instance.id}}">
              <i class="grcicon-attach-color"></i> Assign folder
            </a>
            {{/if_helpers}}
            {{/using}}
            {{/with_current_user_as}}
          {{/if}}
        {{else}}
          {{#if error.errors}}
            <small>
              <strong>Warning:</strong> You need permission to access workflow folder. <a href="https://drive.google.com/folderview?id={{grdive_msg_to_id error.message}}&usp=sharing#">Request access.</a>
            </small>
          {{else}}
            {{! This is a failure state for with_mapping, if something in the mapping doesn't refresh properly }}
            The GDrive folder for this {{instance.class.title_singular}} could not be accessed.
          {{/if_equals}}
        {{/with_mapping}}
      </p>
  </div>
</div>
